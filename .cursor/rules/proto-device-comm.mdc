---
description: Protocol Buffers and device communication message conventions
globs: proto/**/*.proto
alwaysApply: false
---

# Proto & device communication

## Location
- Protobuf definitions: `proto/` (e.g. `navigation.proto`). Used for BLE and Wear OS message framing; same message types on phone (nav-e) and device (e.g. nav-c-prototype).

## Conventions
- Add or extend message types in sync with nav-c (or other companions); document in `docs/guides/device-communication.md` and `docs/rust/protobuf.md`.
- After editing `.proto`: regenerate Dart (via build/codegen if wired) and Rust (e.g. `prost` in `native/device_comm`). Kotlin side (nav-c) uses its own codegen.

## Device comm context
- Frames: magic, msg_type, protocol_version, route_id, seq_no, total_seqs, payload_len, payload, crc32. Chunking in Rust via `chunkMessageForBle`; transport is BLE or Wear OS Message API (prototype). See `docs/guides/device-communication.md`.
