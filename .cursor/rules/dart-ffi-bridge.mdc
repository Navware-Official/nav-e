---
description: Flutter–Rust FFI usage; use public bridge API only
globs: lib/**/*.dart
alwaysApply: false
---

# FFI bridge (Flutter ↔ Rust)

## Public API only
- Import the generated bridge as: `import 'package:nav_e/bridge/lib.dart' as api;`
- Call only functions exposed on that API (e.g. `api.calculateRoute()`, `api.prepareRouteMessage()`, `api.chunkMessageForBle()`).
- Do **not** import or use types from `lib/bridge/` subdirs (e.g. application/, infrastructure/) — those are generated internals.

## After Rust API changes
1. Edit Rust in `native/nav_e_ffi` (and `native/nav_engine` as needed).
2. Run `make codegen` to regenerate Dart bindings.
3. Fix Dart call sites if signatures changed. For Android native libs run `make build-android` (or `build-android-all`).

## Docs
- Guide: `docs/guides/flutter-rust-bridge.md`. Rust layout: `docs/rust/overview.md`.
